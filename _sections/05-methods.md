---
title: "Methods"
order: 5
---
## 1. Accessing metagenome data and controls

### Accessing metagenome data
On February 10th 2015, we used *prefetch*, from [SRA Toolkit (v 2.4.4)](http://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/2.4.4/), to download each of the 1,572 runs associated with SRA study [SRP051511](http://trace.ncbi.nlm.nih.gov/Traces/study/?acc=SRP051511). We then converted each run from SRA format to FASTQ format using *fastq-dump*, again from SRA Toolkit (v 2.4.4). Each FASTQ file was also converted to FASTA format using *fastq_to_fasta* from [FASTX Toolkit (v 0.0.13.2)](http://hannonlab.cshl.edu/fastx_toolkit/download.html). For each SRA run we used the information contained in [SRP051511_info.txt]({{ site.baseurl }}/data/methods/01-accessing-data-and-controls/nyc-supplementary-data/SRP051511_info.txt), acquired from SRP051511's RunInfo Table, to associate sample names used in the study with their corresponding SRA run accessions.

We created the python script, [extract_pathogens.py]({{ site.baseurl }}/data/methods/01-accessing-data-and-controls/extract-pathogens.py), to parse [DataTable5-metaphlan-metadata_v19.txt](/{{ site.baseurl }}/data/methods/01-accessing-data-and-controls/nyc-supplementary-data/DataTable5-metaphlan-metadata_v19.txt). From this we were able to determine which NYC samples contained reads associated with *Bacillus antracis* and the *Yersinia* genus. We then used another python script, [map-pathogens.py]({{ site.baseurl }}/data/methods/01-accessing-data-and-controls/map-pathogens.py) in order to associate the NYC sample names with their corresponding SRA run accession ([Table 1](#table-1)).

### Creating metagenomic controls for *B. anthracis* and a close relative, *B. cereus*
As a control for these analysis we randomly selected NYC sample SRR1749070 which is *B anthracis* free and added different amounts of known *B. anthracis* or *B. cereus* sequences to it. Using these controls we produced results we would expect to see if *B. anthracis* was present in the metagenomic sequences. We used *B. anthracis* ([DRR014739](http://trace.ncbi.nlm.nih.gov/Traces/sra/?run=DRR014739)) (strain H29: isolated in Zambia, unpublished data from Division of Infection and Immunity, Research Center for Zoonosis Control, Hokkaido Univerisity) and *B. cereus* ([SRR642775](http://trace.ncbi.nlm.nih.gov/Traces/sra/?run=SRR642775)) (strain VD143, unpublished data from the Broad Institute) sequencing projects as our controls. The reads from the *B. anthracis* project were trimmed from 300bp (Illumina MiSeq) down to the first 100bp using *fastq_trimmer (v0.0.13.2)* from FASTX Toolkit. This was necessary to make the reads more similar to the NYC sample, SRR1749070, which was 100bp Illumina HiSeq 2000 reads. This step was not necessary for the *B. cereus* control because it too was 100bp Illumina HiSeq 2000 reads.

Each control was then randomly subsampled using *seqtk (commit 43ff625a3211b51f301cb356a34fb8d1e593d50a)* to 0.1x, 0.25x, 0.5x, 1x, and 5x coverage. *B. anthracis* was additionally subsampled to 0.01x, 0.05x and 0.10x coverage. Coverage was estimated using the total size of the *B. anthracis* genome, the pXO1 plasmid and the pXO2 plasmids. For *B. cereus* we used only the total size of the *B. cereus* genome. These subsampled coverages were then added to the sequences of the *B. anthracis* free NYC sample SRR1749070. This produced multiple samples for each control, one with no control sequences and those with the different levels of coverage. These samples were then subjected to the same mapping pipeline as the *B. anthracis* positive samples menthion above. This process of downloading and preparing the controls for analysis was automated using the following scripts [get-anthracis-control.sh]({{ site.baseurl }}/data/methods/01-accessing-data-and-controls/get-anthracis-control.sh) (*B. anthracis*) and [get-cereus-control.sh]({{ site.baseurl }}/data/methods/01-accessing-data-and-controls/get-cereus-control.sh) (*B. cereus*).

## 2. Mapping metagenome data to plasmids (and chromosomes)

### Mapping against pXO1 and pXO2 using BWA
We used *BWA (v 0.7.5a-r405)* to map reads from each of the NYC and control samples against reference pXO1 and pXO2 plasmids as well as reference *B. anthracis* and *B. cereus* completed genomes. We used the following references: pXO1 reference [CP009540](http://www.ncbi.nlm.nih.gov/nuccore/CP009540.1), pXO2 reference [NC_007323](http://www.ncbi.nlm.nih.gov/nuccore/50163691), *B. anthracis* reference [CP009541](http://www.ncbi.nlm.nih.gov/nuccore/CP009541), and *B. cereus* reference [NC_003909](http://www.ncbi.nlm.nih.gov/nuccore/NC_003909). The aligned reads in SAM format were then converted to sorted BAM and indexed using *samtools (v 1.1)*. The per base coverage was extracted using *genomeCoverageBed* from *bedtools (v2.16.2)*. Coverage across the plasmids and chromosomes were plotted for mulitple sliding windows by the Rscript *[plot-coverage.R]({{ site.baseurl }}/data/methods/02-mapping/plot-coverage.R)*. Mapped reads were extracted and saved in both FASTQ and FASTA format using *bam2fastq (v1.1.0)* and *fastq_to_fasta* from *FASTX Toolkit v 0.0.13.2*.

For pXO1, we focused on coverage of the virulence genes (*cya*, *lef*, *pagA* and *pagR*). To visualize this, an alternate plot was created which included subplots of coverage of these genes using the RScript *[plot-pxo1-anthrax-toxin-coverage.R]({{ site.baseurl }}/data/methods/02-mapping/plot-pxo1-anthrax-toxin-coverage.R)*. The reads that mapped to each gene were also extracted and blasted (*blastn v2.2.30+)* against the NT database (built on Feb 9, 2015). For each gene, a count of the organism names of which the top five hits of each read belonged to was recorded.

The analysis of the plasmids was automated using the following scripts *[map-anthracis-plasmids.sh]({{ site.baseurl }}/data/methods/02-mapping/map-anthracis-plasmids.sh)* (NYC samples) and *[map-anthracis-controls.sh]({{ site.baseurl }}/data/methods/02-mapping/map-anthracis-controls.sh)* (control samples). Analysis of the completed chromosomes was automated using the scripts *[map-bacilli-nyc.sh]({{ site.baseurl }}/data/methods/02-mapping/map-bacilli-nyc.sh)* (NYC samples) and *[map-bacilli-controls.sh]({{ site.baseurl }}/data/methods/02-mapping/map-bacilli-controls.sh)* (control samples). Summaries of the results of mapping samples against pXO1, pXO2 and chromosomes were generated using the following scripts: *[mapping-coverage-summary.py]({{ site.baseurl }}/data/methods/02-mapping/mapping-coverage-summary.py)*, *[mapping-gene-summary.py]({{ site.baseurl }}/data/methods/02-mapping/mapping-gene-summary.py)* and *[mapping-top-blast-hits-summary.py]({{ site.baseurl }}/data/methods/02-mapping/mapping-top-blast-hits-summary.py)*

### pXO1 Results
For each sample we calculated the summary statistics of coverage across the complete pXO1 plasmid ([Table 2](#table-2)). NYC sample SRR174708 has the best average coverage (2x), but each of the NYC samples have a median coverage of 0x. These results are nearly the opposite of the *B. anthracis* control. Even at an estimated coverage of 0.25x, the mean coverage of pXO1 is 1.23x (median 1x). The mean coverage only improves as the estimated coverage of *B. anthracis* reads increases. The *B. cereus* control includes low levels of pXO1 overage.

[Figure 1](#figure-1) offers a visual representation in the difference in coverages across the pXO1 plasmid. SRR1748708 was selected because it has the greatest mean coverage of the NYC samples. These three plots depict very different stories. In the *B. cereus* control ([Figure 1C](#figure-1)), although there were few reads that mapped, there exists regions of pXO1 that are similar to *B. cereus*. However, SRR1748708 ([Figure 1A](#figure-1)) **did** have significant coverage across the pXO1 plasmid. Comparing SRR1748708 and the *B. anthracis* control ([Figure 1B](#figure-1)), the similar mean coverages are very different from one another. SRR1748708 has regions of high coverage and regions of low coverage. The *B. anthracis* control, on the other hand, has a very similar coverage across the complete pXO1 plasmid. This suggests SRR1748708 may contain a plasmid backbone that is shared among *Bacillus* species.

The pXO1 plasmid has a mean coverage of 2x in SRR1748708; were the genes associated with the anthrax toxin covered? We next mapped coverage of reads to the *cya*, *lef*, *pagA* and *pagR* genes for SRR1748708 ([Figure 2](#figure-2)) and the *B. anthracis* 0.5x ([Figure 3](#figure-3)) and 5x ([Figure 4](#figure-4)) controls. For each of the plots below the top plot is coverage across the whole pXO1 plasmid. The *B. anthracis* controls clearly showed a number of reads mapping to each of the genes. The total number of reads mapped to each gene for each sample was extracted ([Table 3](#table-3)). At 0.5x a total of 197 reads mapped to these genes. At 5x the coverage the total number of reads mapped jumped to 1,817. clearly evident. Looking at SRR1748708, the genes are essentially devoid of mapped reads but reads are mapped to these genes. Although only 72 reads mapped to these genes it is necessary to investigate these reads further.

The next step was to determine the likely origin of the mapped reads in the each of the genes. In order to do so, we extracted these reads and saved them in FASTA format. We then BLASTed those reads against a local NT database. We chose to only retain the top five hits for each read. Our goal was not to determine the exact organism of origin, but instead to get an idea of what these reads are mapping to ([Table 4](#table-4)). There was a clear difference between the results of the NYC sample SRR1748708 ([Table 4A](#table-4)) and the *B. anthracis* control ([Table 4B](#table-4)). The reads from the *B. anthracis* controls most often return *B. anthracis* (~85%) as the top hit followed by *B. cereus* (~14.6%). The NYC samples did not have a top hit to *B. anthracis*. The most common was *B. thuringiensis* followed by various organisms including humans and other *Bacillus* species. It is important to state that in this case the total hit counts are not important. What is important is the difference between the NYC samples and the control *B. anthracis*.

### pXO2 Results
Similar to pXO1, we calculated the summary statistics of coverage across the complete pXO2 plasmid for each sample ([Table 5](#table-5)). We observed similar patterns of coverage. Again NYC sample SRR174708 has the best mean coverage (4.5x), but each of the NYC samples again have a median coverage of 0x. The *B. anthracis* 0.5x control has a mean coverage of 1.34x (median 1x). Again the mean coverage improves as the estimated coverage of *B. anthracis* reads increases. Finally, as before, the *B. cereus* control contained low levels of pXO2 coverage.

Using methods described previously with pXO1, [Figure 5](#figure-5) offers a visual representation in the difference in coverages across the pXO2 plasmid. Again, SRR1748708 was selected because it has the greatest mean coverage of the NYC samples.

There was clearly a peak in each of the plots above, which is likely a repeat region within the *Bacillus* species. SRR1748708 ([Figure 5A](#figure-5)) mostly maps to this region. As with pXO1, the *B. anthracis* control ([Figure 5B](#figure-5)) maintains similar coverage across the complete pXO2 plasmid. Unlike pXO1, there seems to be a number of regions in pXO2 that are very similar to *B. cereus* as depicted by the plot of the *B. cereus* control ([Figure 5C](#figure-5)).

### Completed *B. anthracis* and *B. cereus* Chromosome Results
In order to demonstrate how similar the chromosomes of *B. anthracis* and *B. cereus* are to one another, we also mapped reads to completed chromosomes. Summary statistics of mapped reads can be found ([Table 6](#table-6), [Table 7](#table-7)). Unlike the pXO1 and pXO2 plasmids each of the NYC samples have a mean coverage greater than 1x for both *B. anthracis* and *B. cereus*. The difference in the mean coverage between *B. anthracis* and *B. cereus* for each NYC sample is negligble (SRR1748707:0.0555, SRR1749083:0.1124, and SRR1748708:0.5252). Again focusing on SRR1748708, because it has the greatest mean coverage against both *B. anthracis* and *B. cereus*, [Figure 6](#figure-6)demonstrates the coverage across each chromosome.

Using 10kb sliding windows (5kb overlap), the two plots above show consistent coverage across both the *B. anthracis* ([Figure 6A](#figure-6)) and *B. cereus* ([Figure 6B](#figure-6)) chromosomes. The discrepency in peaks of coverage can be explained by the location of the origin of replication in each of the references. The other two samples, SRR1748707 and SRR1749083, show similar patterns of consistent coverage. At first glance, these plots could be mistakenly taken as evidence for the presence of both *B. anthracis* and *B. cereus* in the NYC samples. Recall, the genomes of organisms within the *B. cereus group* are very similar to one another. Just how similar?

[Figure 7](#figure-7) demonstrates cross mappings of reads from *B. anthracis* and *B. cereus* to one another. These two plots show *B. cereus* reads consistenly mapping to the *B. anthracis* chromosome ([Figure 7A](#figure-7)) and likewise *B. anthracis* reads consistenly mapping to the *B. cereus* chromosome ([Figure 7B](#figure-7)). The similarity between the two chromosomes would likely cause difficulties distiguishing between the two organisms based on sequence homology alone.

## 3. Species identification with Kraken

We used *Kraken (v. 0.10.4-beta)* and its pre-built Bacteria database to identify *B. anthracis* reads within the B. anthracis* positive NYC samples and our controls (described above). We also used *B. anthracis*, *B cereus* and *B. thurigiensis* sequencing projects as controls. We used python script [parse_kraken.py]({{ site.baseurl }}/data/methods/03-kraken/parse_kraken.py) to extract the propotion of reads covered by *B.anthracis*, *B. cereus* group and other bacteria species respectively in the different samples.

*B. anthracis* reads were detected by Kraken within each of the NYC samples ([Table 8](#table-8)). The results from Kraken [Control Results](/data/results/03-kraken/anthracis-control) suggests that using Kracken we could detect the presence of minute amounts of sequence reads from the organism.

The results from our *B. anthracis*, *B cereus* and *B. thurigiensis* sequencing project controls can be found at the following link: [Anthrax WGS search](https://www.dropbox.com/sh/fwfi75ft4ny1qkk/AADF16diPK-cgV-CmRHzLjWTa?dl=0). See [Figure 8](#figure-8) for a visual representation of the species distribution of each Kraken run.

## 4. Custom SNP assay for the *B. anthracis* core genome

As a first pass, we made a list of SNPs specific to only the *B. anthracis* core genome. These SNPs were not not found in other *B. cereus*. We then extracted SNPs and flanking regions as 31-mers, with the SNP based occupying 16th position.

#### Identifying *B. anthracis* specific SNPs from the whole genome alignment*

ProgressiveMAUVE was used to perform whole genome alignment of 10 *B. cereus* group genomes that were selected based on previously published whole genome phylogeny in order to capture the maximum diversity. ProgressiveMAUVE was performed using script [progressiveMAUVE.sh]({{ site.baseurl }}/data/methods/04-custom-snp-assay/progressiveMAUVE.sh). The *B. cereus* strain ATCC 10987 was used as the reference genome for SNP calling (see below). The 10 genomes ([Table 9](#table-9)) and the progressiveMAUVE output can be accessed [here]({{ site.baseurl }}/data/methods/04-custom-snp-assay/mauve-input).

The MAUVE alignment was loaded into MAUVE Version 2.4.0 in order to visualize the alignment and to export the SNPs using the "export SNP" option. The nucleotide positions of the reference genome (BCE.fasta, ATCC 10987) as well as the corresponding SNP position on the *B. anthracis* genome, along with the 10 nucleotide pattern at the position were extracted. In this nucleotide pattern, the first nuleotide will be from the reference genome and the 3rd nucleotide will be from the B. anthracis genome. Anthrax-specific SNPs (i.e SNP nucloetide positions found in only the Anthrax genome) were identified using the script [GenerateSNPpattern.sh]({{ site.baseurl }}/data/methods/04-custom-snp-assay/GenerateSNPpattern.sh), where a number (corresponding to the position of the nucleotide variant) were assigned. Finally, those nucleotide positions that have only the number 3 assigned (position of the *B. anthracis genome* on the alignment) were extracted along with the corresponding nucleotide positions at the reference genome as well as at the *B. anthracis* genome [Anthrax_specific-SNPPattern.txt](/data/results/04-custom-snp-assay/Anthrax_Specific_SNP_31-mers_9538.txt). In total, 9,538 Anthrax-specific SNPs were identified.

#### Generating all the B. cereus 31-mers to downselect against the 9538 Anthrax-specific SNPs*

Next, using the query:

>[txid86661\[Organism:exp\] NOT txid1392\[Organism:exp\] AND (biomol_genomic\[PROP\] AND refseq\[filter\])](http://www.ncbi.nlm.nih.gov/nuccore/?term=txid86661%5BOrganism%3Aexp%5D+NOT+txid1392%5BOrganism%3Aexp%5D+AND+(biomol_genomic%5BPROP%5D+AND+refseq%5Bfilter%5D))

we downloaded 6,948 *[B. cereus group](http://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id=86661)* (excluding *[Bacillus anthracis](http://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?mode=Info&id=1392)*) sequences in FASTA format from NCBI Refseq to downselect against the 9,538 Anthrax-specific SNPs identified in the first pass.

First, we extracted all the 31-mers in and around all the [9538 Anthrax-specific SNP positions](/data/results/04-custom-snp-assay/Anthrax_Specific_SNP_31-mers_9538.txt) from the *B. anthracis* Ames ancestor genome so that the 16th nucleotide in the 31-mer is the SNP at that specific position. This was done using the script [extractKmers.sh]({{ site.baseurl }}/data/methods/04-custom-snp-assay/extractKmers.sh).

We then generated all the 31-mers present in all the 6,948  *[B. cereus group](http://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id=86661)* (excluding *[Bacillus anthracis](http://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?mode=Info&id=1392)*) using *[JELLYFISH](http://www.cbcb.umd.edu/software/jellyfish/)* by the script [generate-31-mers-BCereusGroup.sh]({{ site.baseurl }}/data/methods/04-custom-snp-assay/generate-31-mers-BCereusGroup.sh). The resultant JELLYFISH database of all the B. cereus 31-mers were queried by the 9,538 Anthrax-specific 31-mers using the script [QueryBcereusGroup.sh]({{ site.baseurl }}/data/methods/04-custom-snp-assay/QueryBcereusGroup.sh). All the 31-mers with zero-counts against the *B. cereus* database were outputed. A total of 1,793 31-mers that had zero-counts were retained and used in all the further downstream analysis.

#### Querying for *B. anthracis* specific 31-mers in the *B. anthracis* and *B. cereus* control groups, and NYC Subway  B. anthracis positive samples.

Here we used the same control samples previously described for B. anthracis and B. cereus in this analysis. All the 31-mers were generated using the script [Getting_KmerCounts.sh]({{ site.baseurl }}/data/methods/04-custom-snp-assay/Getting_KmerCounts.sh). The *B. anthracis* specific 1,793 31-mers were queried against the 31-mer database of all the control and real samples using [QueryAnthraxSNPs.sh]({{ site.baseurl }}/data/methods/04-custom-snp-assay/QueryAnthraxSNPs.sh) and the 31-mers that matched the *B. anthracis* specific 1,793 31-mers were extracted along with their counts in each sample. [Table 10](#table-10) lists the total number of 31-mers found (ie each individual SNP multiplied by the number of occurences).

For those control samples that did not have any *B. anthracis* reads (0x coverage), none of the Anthrax-specific 31-mers were matched, as expected.  From these data, there should be at least 0.01x coverage of *B. anthracis* reads in the sample, which can be considered as the minimum threshold for detection using 31-mers. Even at 5x coverage only 65% of the Anthrax-specific 31-mers were matched. As expected, none of the 31-mers from the samples in the *B. cereus* controls matched to the 31-mer set ([Table 11](#table-11)). This showed that the 1,793 31-mers were specific for *B. anthracis*. Only sample SRR1748708 contained *B. anthracis* -specific 31-mers with a frequency count of 2 for each of the 2 31-mers ([Table 12](#table-12)). This indicated, a potential positive result with *B. anthracis* present at ~ 0.01X coverage. See [Table 13](#table-13) for the annotation of the 2 mapped 31-mers.
